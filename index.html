<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <title>التحديات اليومية</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      margin: 0;
      padding: 20px;
      direction: rtl;
    }

    #progressContainer {
      background: #ddd;
      border-radius: 20px;
      width: 100%;
      max-width: 700px;
      height: 25px;
      margin: 20px auto;
      overflow: hidden;
      box-shadow: inset 0 0 5px #aaa;
    }
    #progressBar {
      height: 100%;
      width: 0%;
      background: #4caf50;
      border-radius: 20px 0 0 20px;
      transition: width 0.5s ease-in-out;
      text-align: center;
      color: white;
      font-weight: bold;
      line-height: 25px;
    }

    #userName {
      max-width: 700px;
      margin: 10px auto;
      font-size: 20px;
      font-weight: bold;
      color: #333;
      text-align: center;
    }

    #menuIcon {
      position: fixed;
      top: 20px;
      left: 20px;
      width: 30px;
      cursor: pointer;
      z-index: 1000;
    }
    #menuIcon div {
      height: 4px;
      margin: 6px 0;
      background: #333;
      border-radius: 2px;
    }
    #logoutBtn {
      display: none;
      position: fixed;
      top: 70px;
      left: 20px;
      background: red;
      color: #fff;
      border: none;
      padding: 8px 12px;
      border-radius: 4px;
      cursor: pointer;
      z-index: 1000;
    }

    .quarter {
      max-width: 700px;
      margin: 40px auto;
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .quarterTitle {
      font-size: 20px;
      margin-bottom: 10px;
      color: #333;
      text-align: center;
    }

    .daysContainer {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 10px;
    }

    .day {
      background: #eee;
      border-radius: 6px;
      padding: 10px;
      font-size: 14px;
      cursor: pointer;
      transition: 0.3s;
      text-align: center;
    }

    .day.locked {
      background: #ccc;
      color: #666;
      cursor: not-allowed;
    }

    .day.open {
      background: #fff3cd;
    }

    .day.completed {
      background: #c8e6c9;
      color: #2e7d32;
    }

    .challengeDesc {
      text-align: right;
      margin-top: 8px;
    }
  </style>
</head>
<body>

<script>
  if (localStorage.getItem("loggedIn") !== "true") {
    window.location.href = "register.html";
  }
</script>

<div id="menuIcon"><div></div><div></div><div></div></div>
<button id="logoutBtn">تسجيل الخروج</button>

<div id="userName">مرحباً، <span id="userDisplay"></span></div>

<div id="progressContainer">
  <div id="progressBar">0%</div>
</div>

<div id="quartersContainer"></div>

<script>
  const userEmail = localStorage.getItem("registeredEmail") || "المستخدم";
  const userAge = parseInt(localStorage.getItem("registeredAge") || "18");
  document.getElementById("userDisplay").textContent = userEmail;

  const menuIcon = document.getElementById('menuIcon');
  const logoutBtn = document.getElementById('logoutBtn');
  menuIcon.addEventListener('click', () => {
    logoutBtn.style.display = logoutBtn.style.display === 'block' ? 'none' : 'block';
  });
  logoutBtn.addEventListener('click', () => {
    localStorage.removeItem('loggedIn');
    window.location.href = 'login.html';
  });

  const totalDays = 365;
  const daysPerQuarter = totalDays / 4;
  const quartersContainer = document.getElementById('quartersContainer');

  function getChallengesByAge(age) {
    if (age < 24) {
      return ["5 ضغط", "أكل صحي", "قراءة صفحتين", "نوم باكر"];
    } else if (age < 30) {
      return ["10 ضغط", "رياضة 15 دقيقة", "قراءة 5 صفحات", "تأمل"];
    } else if (age < 36) {
      return ["15 ضغط", "رياضة 30 دقيقة", "أكل نباتي", "كتابة أهداف"];
    } else if (age < 48) {
      return ["تمارين قوة", "رياضة ساعة", "تنظيم نوم", "مشي 5 كم"];
    } else {
      return ["تمارين خفيفة", "مشي 15 دقيقة", "قراءة خفيفة", "راحة وتأمل"];
    }
  }

  const challengeSet = getChallengesByAge(userAge);
  const userChallenges = [];
  for (let d = 1; d <= daysPerQuarter; d++) {
    userChallenges.push({ day: d, list: challengeSet });
  }

  for (let q = 0; q < 4; q++) {
    const quarterDiv = document.createElement('div');
    quarterDiv.className = 'quarter';

    const quarterTitle = document.createElement('div');
    quarterTitle.className = 'quarterTitle';
    quarterTitle.textContent = `ربع السنة ${q + 1}`;
    quarterDiv.appendChild(quarterTitle);

    const daysContainer = document.createElement('div');
    daysContainer.className = 'daysContainer';

    for (let d = 1; d <= daysPerQuarter; d++) {
      const globalDay = q * daysPerQuarter + d;
      const dayDiv = document.createElement('div');
      dayDiv.className = 'day locked';
      dayDiv.dataset.globalDay = globalDay;
      dayDiv.textContent = `يوم ${globalDay}`;

      const challengeData = userChallenges.find(c => c.day === d);
      if (challengeData) {
        const desc = document.createElement('div');
        desc.className = 'challengeDesc';

        let htmlList = '<ul>';
        for (const item of challengeData.list) {
          htmlList += `<li>${item}</li>`;
        }
        htmlList += '</ul>';
        desc.innerHTML = htmlList;
        dayDiv.appendChild(desc);
      }

      daysContainer.appendChild(dayDiv);
    }

    quarterDiv.appendChild(daysContainer);
    quartersContainer.appendChild(quarterDiv);
  }

  let progressData = localStorage.getItem('progressData');
  let progress = progressData ? JSON.parse(progressData) : { lastCompletedDay: 0 };

  function updateUI() {
    const days = document.querySelectorAll('.day');
    days.forEach(day => {
      const dayNum = Number(day.dataset.globalDay);
      if (dayNum <= progress.lastCompletedDay + 1) {
        day.classList.remove('locked');
        day.classList.add('open');
      }
      if (dayNum <= progress.lastCompletedDay) {
        day.classList.remove('open');
        day.classList.add('completed');
      }
    });

    const percent = Math.round((progress.lastCompletedDay / totalDays) * 100);
    const progressBar = document.getElementById('progressBar');
    progressBar.style.width = percent + '%';
    progressBar.textContent = percent + '%';
  }

  function refreshDayListeners() {
    document.querySelectorAll('.day.open').forEach(day => {
      day.addEventListener('click', () => {
        const dayNum = Number(day.dataset.globalDay);
        if (dayNum === progress.lastCompletedDay + 1) {
          const confirmComplete = confirm(`هل أكملت تحديات يوم ${dayNum}؟`);
          if (confirmComplete) {
            progress.lastCompletedDay = dayNum;
            localStorage.setItem('progressData', JSON.stringify(progress));
            updateUI();
            refreshDayListeners();
            alert('تهانينا على إكمال التحديات!');
          }
        } else {
          alert('يرجى إكمال الأيام السابقة أولاً.');
        }
      });
    });
  }

  updateUI();
  refreshDayListeners();
</script>
</body>
</html>